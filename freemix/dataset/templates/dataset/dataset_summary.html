{% load i18n %}
{% load freemix_helpers %}

<li class="dataset_summary result_set_item clearfix {% if dataset.published %}public{% else %}private{% endif %}">

    <div class="dataset-name"><a href="{{ dataset.get_absolute_url }}">{{ dataset.title }}</a></div>
    <div class="dataset-description">
        {% if dataset.description %}
                {% ifnotequal dataset.description dataset.description|truncatewords:20 %}
                <span class="short-description">
                {{ dataset.description|safe|truncatewords:20 }}
                    <a class="readmore" href="{{ dataset.get_absolute_url }}">read more</a>
                </span>
                <span class="long-description ui-helper-hidden">
                    {{ dataset.description|safe }}
                </span>
                {%  else %}
                    {{ dataset.description|safe }}
                {% endifnotequal %}
       {% endif %}
    </div>
    <div class="dataset-left">
        <div class="dataset-creator">
          <span class="property-label">{% trans "Loaded by:" %} </span> <a href="{% url profile_detail dataset.owner.username %}">{{ dataset.owner|nicename }}</a>
        </div>
        <div class="dataset-created-data"><span class="property-label">{% trans "Loaded on:" %} </span>{{ dataset.created|date:"N j, Y" }}</div> 
        <div class="dataset-modified-data"><span class="property-label">{% trans "Last Modified:" %} </span>{{ dataset.modified|date:"N j, Y" }}</div>

        {% ifnotequal dataset.exhibits.count 0 %}
        <div class="dataset-usedin">
          <span class="property-label">{% trans "Basis for:" %}</span>
          <span class="view-count"><a href="{% url exhibits_by_dataset owner=dataset.owner.username slug=dataset.slug %}">{{ dataset.exhibits.count }} {% trans "Data View" %}{{ dataset.exhibits.count|pluralize }}</a></span>
        </div>
        {% endifnotequal %}

    </div>

    {% if request.user.is_authenticated %}

    <div class="dataset-right">

      <div class="dataset-links">
	
        <span class="action action_create_dataset">
          <a class="dataset_create" href="{% url build_new_freemix username=request.user.username dataset=dataset.get_absolute_url %}">{% trans "Build" %}</a>
        </span>

        <span class="divider">|</span>

        <span class="action action_create_dataset">
          <a class="dataset_export" href="{% url dataset_data_json owner=dataset.owner.username slug=dataset.slug %}">{% trans "Export" %}</a>
        </span>

        {% ifequal request.user.username dataset.owner.username %}
        <span class="divider">|</span>

        <span class="action action_edit_dataset">
          <a class="dataset_edit" href="{% url dataset_edit owner=dataset.owner.username slug=dataset.slug %}">{% trans "Edit" %}</a>
        </span>

        <span class="divider">|</span>

        <span class="action action_edit_dataset">
            <a class="dataset_delete" href="{{ dataset.get_absolute_url }}">{% trans "Delete" %}</a>
        </span>
        {% endifequal %}

      </div>
    </div>
   {% endif %}

</li>
